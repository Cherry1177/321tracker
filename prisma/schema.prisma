// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Goals
  goals         Goal[]
  
  // Friends (bidirectional)
  sentFriendRequests     FriendRequest[] @relation("Sender")
  receivedFriendRequests FriendRequest[] @relation("Receiver")
  friendshipsAsUser1     Friendship[]    @relation("User1")
  friendshipsAsUser2     Friendship[]    @relation("User2")
  
  // Achievements
  achievements  Achievement[]
  
  // Streaks
  streaks       Streak[]
  
  @@map("users")
}

model Goal {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  completions Completion[]
  
  @@map("goals")
}

model Completion {
  id          String   @id @default(cuid())
  goalId      String
  date        DateTime @default(now())
  photoUrl    String?
  notes       String?
  createdAt   DateTime @default(now())
  
  goal        Goal     @relation(fields: [goalId], references: [id], onDelete: Cascade)
  
  @@index([goalId, date])
  @@map("completions")
}

model Achievement {
  id          String   @id @default(cuid())
  userId      String
  photoUrl    String
  caption     String?
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("achievements")
}

model FriendRequest {
  id          String   @id @default(cuid())
  senderId    String
  receiverId  String
  status      String   @default("pending") // pending, accepted, rejected
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  sender      User     @relation("Sender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver    User     @relation("Receiver", fields: [receiverId], references: [id], onDelete: Cascade)
  
  @@unique([senderId, receiverId])
  @@map("friend_requests")
}

model Friendship {
  id          String   @id @default(cuid())
  user1Id     String
  user2Id     String
  createdAt   DateTime @default(now())
  
  user1       User     @relation("User1", fields: [user1Id], references: [id], onDelete: Cascade)
  user2       User     @relation("User2", fields: [user2Id], references: [id], onDelete: Cascade)
  
  @@unique([user1Id, user2Id])
  @@map("friendships")
}

model Streak {
  id          String   @id @default(cuid())
  userId      String
  date        DateTime @default(now())
  goalsCompleted Int   @default(0)
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, date])
  @@index([userId, date])
  @@map("streaks")
}
